function Tab(_name,_content,_machinecode){return{name:_name,content:_content,machinecode:_machinecode,console:"",instructionLog:"",instructionSet:ISA_MIPS,memorySize:4096,core:null,inSimulation:!1,registers:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],regStates:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]}}function resizeMC(){}function resizeRAM(){}function resize(){resizeMC(),resizeRAM()}function addConsoleMsg(msg,type){var typeStr="";type==CONSOLE_ERROR?typeStr=" class='error'":type==CONSOLE_SUCCESS?typeStr=" class='success'":type==CONSOLE_WARNING&&(typeStr=" class='warning'"),$("#console").append("<span"+typeStr+">"+msg+"</span>")}function uiAssemble(){var val=editor.getValue();if(""!=val){var core=tabs[currentTab].core;resetCore(core);var val=editor.getValue(),output=assemble(core,val);$("#console").html(""),null==output.errorMessage?($("#machineCode").val(output.machineCode.Oak_hex()),addConsoleMsg("<b>Assembly Succeeded!</b",CONSOLE_SUCCESS)):addConsoleMsg("<b>Assembler Error: </b>"+output.errorMessage,CONSOLE_ERROR),tabs[currentTab].inSimulation=!1}}function prepareSim(){var core=tabs[currentTab].core;$("#console").html().length>0&&($("#console").html(""),$("#log").html("")),resetCore(core);for(var val=$("#machineCode").val(),bytes=[],hex=val.split(" "),i=0;i<hex.length;i++){var byte=parseInt(hex[i],16);isNaN(byte)||bytes.push(byte)}if(0==bytes.length)return void addConsoleMsg("<b>ERROR: </b>No valid machine code.",CONSOLE_ERROR);if(tabs[currentTab].memorySize<=bytes.length)return void addConsoleMsg("<b>ERROR: </b>The allocated memory size is not big enough to contain the program. It needs to be at least "+bytes.length+" bytes.",CONSOLE_ERROR);for(var i=0;i<32;i++)tabs[currentTab].regStates[i]=REGISTER_UNASSIGNED;return startSim=performance.now(),bytes}function uiStepbystep(){var core=tabs[currentTab].core;if(0==tabs[currentTab].inSimulation){var bytes=prepareSim(),load=loadIntoMemory(core,bytes);if(null!==load)return void addConsoleMsg("<b>Failed to load machine code into memory: </b>"+load,CONSOLE_ERROR);tabs[currentTab].inSimulation=!0}var output=simulateStep(core);if("@Oak_Ecall"!=output){addConsoleMsg("<b>Simulator Step: </b>"+$("#log > span:last-child").html(),CONSOLE_NORMAL),updateRegAndMemory()}else null!=output&&"@Oak_Ecall"!=output&&(updateRegAndMemory(),addConsoleMsg("<b>Simulator Error: </b>"+output,CONSOLE_ERROR))}function displayMemory(){var core=tabs[currentTab].core,memory=getMemory(core);$("#memory").html("");for(var i=0;i<memory.length;i++){var memOut=memory[i];$("#memory").append("0x"+padNo(memOut.toString(16),2)+" ")}}function updateRegAndMemory(){var core=tabs[currentTab].core,t0=performance.now();console.log("Updating memory/registers...");for(var modReg=core.registerFile.getModifiedRegisters(),i=0;i<32;i++)tabs[currentTab].registers[i]=registerRead(core,i),modReg[i]?tabs[currentTab].regStates[i]=REGISTER_NEWASSIGNED:tabs[currentTab].regStates[i]==REGISTER_NEWASSIGNED&&(tabs[currentTab].regStates[i]=REGISTER_ASSIGNED);displayMemory(),showRegisters();var t1=performance.now();console.log("Memory/register update done in "+(t1-t0)+"ms.")}function uiSimulate(){if(tabs[currentTab].inSimulation){tabs[currentTab].inSimulation=!1;var output=continueSim(tabs[currentTab].core);"@Oak_Ecall"!=output&&null!=output&&(updateRegAndMemory(),addConsoleMsg("<b>Simulator Error: </b>"+output,CONSOLE_ERROR))}else{var core=tabs[currentTab].core,bytes=prepareSim(),output=simulate(core,bytes);"@Oak_Ecall"!==output&&null!=output&&(updateRegAndMemory(),addConsoleMsg("<b>Simulator Error: </b>"+output,CONSOLE_ERROR))}}function switchModes(type){switch(type){case ISA_MIPS:return void editor.getSession().setMode("ace/mode/mips");default:case ISA_RISCV:return void editor.getSession().setMode("ace/mode/riscv")}}function createCore(type,size,ecallback,dcallback){switch(type){case ISA_MIPS:return new MIPSCore(size,ecallback,dcallback);default:case ISA_RISCV:return new RISCVCore(size,ecallback,dcallback)}}function updateMemorySize(newSize){if(newSize!=tabs[currentTab].memorySize){if(newSize<8)return void addConsoleMsg("<b>ERROR: </b> Please make the memory at least 8 bits. It should be enough to contain all instructions.",CONSOLE_ERROR);tabs[currentTab].memorySize=newSize,delete tabs[currentTab].core,tabs[currentTab].core=createCore(tabs[currentTab].instructionSet,newSize,invokeEnvironmentCall,decodeCallback),updateRegAndMemory(),$("#console").html(""),addConsoleMsg("<b>Success: </b> Memory has been resized. (Please make sure the new memory size fits your program!)",CONSOLE_SUCCESS)}}function setConsoleMode(mode){0==mode?($("#memory, #log").css("display","none"),$("#console").css("display","block")):1==mode?($("#console, #log").css("display","none"),$("#memory").css("display","block")):($("#console, #memory").css("display","none"),$("#log").css("display","block")),$("#consoleSel").val(mode)}function showRegisters(){for(var mode=parseInt($("#regSel").val()),registers=tabs[currentTab].registers,rows=$("table > tbody > tr"),cells=$("table > tbody > tr > td:nth-child(2)"),i=0;i<registers.length;i++){var output;switch(mode){case 0:output="0x"+padNo((registers[i]>>>0).toString(16),8);break;case 1:output=(registers[i]>>>0).toString(10);break;case 2:output=registers[i].toString(10),output>2147483648&&(output-=4294967296);break;case 3:output="0b"+padNo((registers[i]>>>0).toString(2),32);break;case 4:output=oakParseToFloat(registers[i])}switch(cells.eq(i).html(output),tabs[currentTab].regStates[i]){default:rows.eq(i).removeClass("justEdited").removeClass("edited");break;case REGISTER_ASSIGNED:rows.eq(i).removeClass("justEdited").addClass("edited");break;case REGISTER_NEWASSIGNED:rows.eq(i).addClass("justEdited").removeClass("edited")}}}function invokeEnvironmentCall(){var core=tabs[currentTab].core,type=registerRead(core,17),arg=registerRead(core,10);if(1==tabs[currentTab].inSimulation){addConsoleMsg("<b>Simulator Step: </b>"+$("#log > span:last-child").html(),CONSOLE_NORMAL),updateRegAndMemory()}setConsoleMode(0);var exit=!1;switch(type){case 1:$("#console").append("<span> >>> "+arg+"</span>");break;case 4:for(var pointer=arg,output="",char=core.memory[pointer];0!=char;)output+=String.fromCharCode(char),pointer+=1,char=core.memory[pointer];console.log(output),$("#console").append("<span> >>> "+output+"</span>");break;case 5:updateRegAndMemory();var input=prompt("Please enter a number as input.");tabs[currentTab].registers[17]=parseInt(input),registerWrite(core,17,parseInt(input)),$("#console").append("<span class='input insertable'> <<< "+input+"</span>");break;case 8:updateRegAndMemory();for(var input=prompt("Please enter a string as input."),bytes=[],i=0;i<input.length;i++)bytes.push(255&input.charCodeAt(i));core.memset(tabs[currentTab].registers[10],bytes),$("#console").append("<span class='input insertable'> <<< "+input+"</span>");break;case 10:exit=!0;break;case 420:var link;switch(arg){default:link="https://youtube.com/watch?v=KZACorHeE-c";break;case 1:link="https://youtube.com/watch?v=L_jWHffIx5E";break;case 2:link="https://youtube.com/watch?v=dQw4w9WgXcQ";break;case 3:link="https://youtube.com/watch?v=VONRQMx78YI";break;case 4:link="https://youtube.com/watch?v=mtf7hC17IBM";break;case 5:link="https://youtube.com/watch?v=yKNxeF4KMsY"}window.open(link,"_blank").focus();break;case 1776:;addConsoleMsg("[AARON BURR]<br /><br />How does a bastard, orphan, son of a whore and a<br /><br />Scotsman, dropped in the middle of a forgotten<br /><br />Spot in the Caribbean by providence, impoverished, in squalor<br /><br />Grow up to be a hero and a scholar?<br /><br /><br /><br />[JOHN LAURENS]<br /><br />The ten-dollar Founding Father without a father<br /><br />Got a lot farther by working a lot harder<br /><br />By being a lot smarter<br /><br />By being a self-starter<br /><br />By fourteen, they placed him in charge of a trading charter<br /><br /><br /><br />[THOMAS JEFFERSON]<br /><br />And every day while slaves were being slaughtered and carted<br /><br />Away across the waves, he struggled and kept his guard up<br /><br />Inside, he was longing for something to be a part of<br /><br />The brother was ready to beg, steal, borrow, or barter<br /><br /><br /><br />[JAMES MADISON]<br /><br />Then a hurricane came, and devastation reigned<br /><br />Our man saw his future drip, dripping down the drain<br /><br />Put a pencil to his temple, connected it to his brain<br /><br />And he wrote his first refrain, a testament to his pain<br /><br /><br /><br />[BURR]<br /><br />Well, the word got around, they said, “This kid is insane, man”<br /><br />Took up a collection just to send him to the mainland<br /><br />“Get your education, don’t forget from whence you came, and<br /><br />The world's gonna know your name. What’s your name, man?”<br /><br /><br /><br />[ALEXANDER HAMILTON]<br /><br />Alexander Hamilton<br /><br />My name is Alexander Hamilton<br /><br />And there’s a million things I haven’t done<br /><br />But just you wait, just you wait...<br /><br /><br /><br />[ELIZA HAMILTON]<br /><br />When he was ten his father split, full of it, debt-ridden<br /><br />Two years later, see Alex and his mother bed-ridden<br /><br />Half-dead sittin' in their own sick, the scent thick<br /><br /><br /><br />[FULL COMPANY EXCEPT HAMILTON (whispering)]<br /><br />And Alex got better but his mother went quick<br /><br /><br /><br />[GEORGE WASHINGTON]<br /><br />Moved in with a cousin, the cousin committed suicide<br /><br />Left him with nothin’ but ruined pride, something new inside<br /><br />A voice saying<br /><br /><br /><br />[WASHINGTON]<br /><br />“You gotta fend for yourself.”\t[COMPANY]<br /><br />“Alex, you gotta fend for yourself.”<br /><br />[WASHINGTON]<br /><br />He started retreatin’ and readin’ every treatise on the shelf<br /><br /><br /><br />[BURR]<br /><br />There would have been nothin’ left to do<br /><br />For someone less astute<br /><br />He woulda been dead or destitute<br /><br />Without a cent of restitution<br /><br />Started workin’, clerkin’ for his late mother’s landlord<br /><br />Tradin’ sugar cane and rum and all the things he can’t afford<br /><br />Scammin’ for every book he can get his hands on<br /><br />Plannin’ for the future see him now as he stands on<br /><br />The bow of a ship headed for a new land<br /><br />In New York you can be a new man\t <br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br />[COMPANY]<br /><br />Scammin’<br /><br /><br /><br />Plannin’<br /><br />Oooh...<br /><br />[COMPANY]<br /><br />In New York you can<br /><br />Be a new man—<br /><br />In New York you can<br /><br />Be a new man—\t[HAMILTON]<br /><br />Just you wait!<br /><br /><br /><br />Just you wait!<br /><br />[COMPANY]<br /><br />In New York you can be a new man—<br /><br /><br /><br />[WOMEN]<br /><br />In New York—\t <br /><br />[MEN]<br /><br />New York—<br /><br />[HAMILTON]<br /><br />Just you wait!<br /><br /><br /><br />[COMPANY]<br /><br />Alexander Hamilton<br /><br /><br /><br />We are waiting in the wings for you<br /><br /><br /><br />You could never back down<br /><br />You never learned to take your time!<br /><br /><br /><br />Oh, Alexander Hamilton<br /><br /><br /><br />When America sings for you<br /><br />Will they know what you overcame?<br /><br />Will they know you rewrote the game?<br /><br />The world will never be the same, oh<br /><br /><br /><br />[BURR]<br /><br />The ship is in the harbor now<br /><br />See if you can spot him<br /><br /><br /><br />Another immigrant<br /><br />Comin’ up from the bottom<br /><br /><br /><br />His enemies destroyed his rep<br /><br />America forgot him\t <br /><br />[COMPANY]<br /><br />Alexander Hamilton<br /><br /><br /><br />Waiting in the wings for you<br /><br /><br /><br />You never learned to take your time!<br /><br /><br /><br />Oh, Alexander Hamilton<br /><br />Alexander Hamilton…<br /><br />America sings for you<br /><br />Will they know what you overcame?<br /><br />Will they know you rewrote the game?<br /><br />The world will never be the same, oh<br /><br /><br /><br /><br /><br />[MEN]<br /><br />Just you wait<br /><br /><br /><br />[COMPANY]<br /><br />Just you wait<br /><br /><br /><br /><br /><br /><br /><br />[MULLIGAN/MADISON & LAFAYETTE/JEFFERSON]<br /><br />We fought with him<br /><br /><br /><br />[LAURENS/PHILIP]<br /><br />Me? I died for him<br /><br /><br /><br />[WASHINGTON]<br /><br />Me? I trusted him<br /><br /><br /><br />[ELIZA & ANGELICA & PEGGY/MARIA]<br /><br />Me? I loved him<br /><br /><br /><br />[BURR]<br /><br />And me? I’m the damn fool that shot him<br /><br /><br /><br />[COMPANY]<br /><br />There’s a million things I haven’t done<br /><br />But just you wait!<br /><br /><br /><br />[BURR]<br /><br />What’s your name, man?<br /><br /><br /><br />[COMPANY]<br /><br />Alexander Hamilton!",CONSOLE_SUCCESS);break;default:addConsoleMsg("<b>WARNING:</b> Environment call "+type+" unsupported.",CONSOLE_WARNING)}if(1==tabs[currentTab].inSimulation&&updateRegAndMemory(),exit){tabs[currentTab].inSimulation=!1;var time=performance.now()-startSim,numInstructions=$("#log > span").length,ips=1e3*numInstructions/time;addConsoleMsg("<b>Complete:</b> Simulation completed in "+Math.round(time)+" ms, "+numInstructions+" instructions, "+Math.round(ips)+" instructions/second.",CONSOLE_SUCCESS)}else if(0==tabs[currentTab].inSimulation){var output=continueSim(core);"@Oak_Ecall"!=output&&null!=output&&(updateRegAndMemory(),addConsoleMsg("<b>Simulator Error: </b>"+output,CONSOLE_ERROR))}}function decodeCallback(data){$("#log").append("<span>"+data+"</span>")}function setOptionsTab(index){for(var i=0;i<3;i++)i==index?($("aside > div").eq(i+2).addClass("selected"),$(".optionsTabs > div").eq(i).addClass("selected")):($("aside > div").eq(i+2).removeClass("selected"),$(".optionsTabs > div").eq(i).removeClass("selected"))}function padNo(str,length){for(var padded=str,i=0;i<length-str.length;i++)padded="0"+padded;return padded}function oakParseFromFloat(num){var sign=num<0,signString=sign?"1":"0",flParts=num.toString().split("."),wholePart=parseInt(flParts[0]),fracPart=0;isNaN(wholePart)&&(wholePart=0),flParts.length>1&&(fracPart=parseInt(flParts[1]));for(var wholeMantissa=(wholePart>>>0).toString(2),fracMantissaStr="",fracPartParsing=parseFloat("0."+fracPart.toString()),i=0;fracPartParsing>0;){var potentialAdd=Math.pow(2,-i-1);fracPartParsing-potentialAdd<0?fracMantissaStr+="0":(fracPartParsing-=potentialAdd,fracMantissaStr+="1"),i++}var finalMantissa=parseInt(wholeMantissa.substr(1)+fracMantissaStr,2).toString(2);alert(wholeMantissa);var exponent;exponent=wholeMantissa>0?wholeMantissa.length:-fracMantissaStr.length,finalMantissa=parseInt(wholeMantissa.substr(1)+fracMantissaStr,2).toString(2).substring(0,23),exponent+=127,exponent=Math.log2(exponent);var exponentStr=(exponent>>>0).toString(2),finalStr=signString+"|"+padNo(exponentStr,8)+"|"+padNo(finalMantissa,23);return alert(finalStr),parseInt(finalStr,2)}function downloadAsm(){var data=editor.getValue();if(0!=data.length){var el=document.createElement("a"),blob=new Blob([data],{type:"text/plain"}),blobLink=URL.createObjectURL(blob),name=tabs[currentTab].name+".s";el.setAttribute("href",blobLink),el.setAttribute("download",name),el.style.display="none",document.body.appendChild(el),el.click(),document.body.removeChild(el)}}function downloadBin(){var data=$("#machineCode").val();if(0!=data.length){for(var hexdata=data.split(" "),bytes=[],i=0;i<hexdata.length;i++){var v=parseInt(hexdata[i],16);isNaN(v)||bytes.push(v)}var byteArray=new Uint8Array(bytes),blob=new Blob([byteArray],{type:"application/octet-stream"}),blobLink=URL.createObjectURL(blob),element=document.createElement("a"),name=tabs[currentTab].name+".bin";element.setAttribute("href",blobLink),element.setAttribute("download",name),element.style.display="none",document.body.appendChild(element),element.click(),document.body.removeChild(element)}}function downloadRam(){var data=$("#memory").html();if(0!=data.length){for(var hexdata=data.split(" "),bytes=[],i=0;i<hexdata.length;i++){var v=parseInt(hexdata[i],16);isNaN(v)||bytes.push(v)}var byteArray=new Uint8Array(bytes),blob=new Blob([byteArray],{type:"application/octet-stream"}),blobLink=URL.createObjectURL(blob),element=document.createElement("a"),name=tabs[currentTab].name+".ram";element.setAttribute("href",blobLink),element.setAttribute("download",name),element.style.display="none",document.body.appendChild(element),element.click(),document.body.removeChild(element)}}function encodeFloat(number){var i,lastBit,rounded,j,exponent,n=+number,status=n!==n||n==-(1/0)||n==+(1/0)?n:0,exp=0,bin=new Array(281),signal=(n=0!==status?0:n)<0,n=Math.abs(n),intPart=Math.floor(n),floatPart=n-intPart;if(0!==status){if(n!==n)return 2143289344;if(n===1/0)return 2139095040;if(n===-(1/0))return 4286578688}for(i=281;i;)bin[--i]=0;for(i=129;intPart&&i;)bin[--i]=intPart%2,intPart=Math.floor(intPart/2);for(i=128;floatPart>0&&i;)(bin[++i]=((floatPart*=2)>=1)-0)&&--floatPart;for(i=-1;++i<281&&!bin[i];);if(bin[(lastBit=22+(i=(exp=128-i)>=-126&&exp<=127?i+1:128-(exp=-127)))+1]){if(!(rounded=bin[lastBit]))for(j=lastBit+2;!rounded&&j<281;)rounded=bin[j++];for(j=lastBit+1;rounded&&--j>=0;)(bin[j]=!bin[j]-0)&&(rounded=0)}for(i=i-2<0?-1:i-3;++i<281&&!bin[i];);for((exp=128-i)>=-126&&exp<=127?++i:exp<-126&&(i=255,exp=-127),(intPart||0!==status)&&(exp=128,i=129,status==-(1/0)?signal=1:status!==status&&(bin[i]=1)),n=Math.abs(exp+127),exponent=0,j=0;j<8;)exponent+=n%2<<j,n>>=1,j++;var mantissa=0;for(n=i+23;i<n;i++)mantissa=(mantissa<<1)+bin[i];return(signal?2147483648:0)+(exponent<<23)+mantissa|0}function oakParseToFloat(num){var sign=1;2147483648&num&&(sign=-1);var exp=(2139095040&num)>>23;exp=Math.pow(2,exp-127);for(var mantissa=8388607&num,i=0;i<23;i++)mantissa/=2;return mantissa+=1,sign*exp*mantissa}function converter(){var input=$("#inputVal").val();switch(parseInt($("#inputSel").val())){case 0:input=parseInt(input,16);break;case 1:case 2:input=parseInt(input,10);break;case 3:input=parseInt(input,2);break;case 4:input=encodeFloat(input)}"NaN"==input.toString()&&alert("Invalid value for input!");var output;switch(parseInt($("#outputSel").val())){case 0:output="0x"+padNo((input>>>0).toString(16),8);break;case 1:output=(input>>>0).toString(10);break;case 2:(output=input.toString(10))>2147483648&&(output-=4294967296);break;case 3:output="0b"+padNo((input>>>0).toString(2),32);break;case 4:output=oakParseToFloat(input)}$("#outputVal").val(output)}var ISA_RISCV=0,ISA_MIPS=1,tabs=[],currentTab=-1,editor,mcEditor,CONSOLE_ERROR=0,CONSOLE_SUCCESS=1,CONSOLE_WARNING=2,CONSOLE_NORMAL=3,REGISTER_UNASSIGNED=0,REGISTER_ASSIGNED=1,REGISTER_NEWASSIGNED=2,startSim;!function(){"use strict";function setRegisterNames(){for(var regNames=tabs[currentTab].core.instructionSet.abiNames,cells=$("table tr > td:first-child"),i=0;i<regNames.length;i++)cells.eq(i).html(regNames[i]);showRegisters()}function addTab(name,code,machinecode){0!=tabs.length&&(tabs[currentTab].content=editor.getValue(),tabs[currentTab].machinecode=mcEditor.val(),tabs[currentTab].instructionLog=$("#log").html(),tabs[currentTab].console=$("#console").html()),$("body").removeClass("noTab"),$("section nav > div").removeClass("selected"),currentTab=$("section nav > div").length,$("section nav").append(defaultTab),$("section nav > div.selected span").html(name),$("section nav > div.selected").on("click",function(){switchToTab($(this).index())}),$("section nav > div.selected > div").on("click",function(e){removeTab($(this).parent().index()),e.preventDefault()}),$("#regSel").on("change",function(){showRegisters()}),$("#filename").val(name),$("#memsize").val(4096),$("#console").html(""),$("#memory").html(""),$("#log").html(""),tabs.push(Tab(name,code,machinecode)),tabs[currentTab].instructionSet=ISA_MIPS,tabs[currentTab].core=createCore(tabs[currentTab].instructionSet,4096,invokeEnvironmentCall,decodeCallback),$("#isa").val(tabs[currentTab].instructionSet),switchModes(tabs[currentTab].instructionSet),editor.setValue(code),mcEditor.val(machinecode),setRegisterNames()}function switchToTab(num){tabs[currentTab].content=editor.getValue(),tabs[currentTab].machinecode=mcEditor.val(),tabs[currentTab].console=$("#console").html(),tabs[currentTab].instructionLog=$("#log").html(),editor.setValue(tabs[num].content),mcEditor.val(tabs[num].machinecode);var tabsEl=$("section nav > div");tabsEl.eq(currentTab).removeClass("selected"),tabsEl.eq(num).addClass("selected"),$("#filename").val(tabs[num].name),$("#isa").val(tabs[num].instructionSet),$("#memsize").val(tabs[num].memorySize),$("#console").html(tabs[num].console),$("#log").html(tabs[num].instructionLog),switchModes(tabs[num].instructionSet),currentTab=num,displayMemory(),setRegisterNames()}function removeTab(id){if(1==tabs.length)tabs.pop(),$("section nav").html(""),$("body").addClass("noTab"),currentTab=-1;else if(tabs.splice(id,1),$("section nav > div").eq(id).remove(),currentTab>id)currentTab--;else if(currentTab==id){0!=id&&currentTab--;var tabsEl=$("section nav > div");tabsEl.removeClass("selected"),tabsEl.eq(currentTab).addClass("selected"),switchModes(tabs[currentTab].instructionSet),$("#filename").val(tabs[currentTab].name),$("#isa").val(tabs[currentTab].instructionSet),$("#memsize").val(tabs[currentTab].memorySize),editor.setValue(tabs[currentTab].content),mcEditor.val(tabs[currentTab].machineCode),$("#console").html(tabs[currentTab].console),$("#log").html(tabs[currentTab].instructionLog),displayMemory(),setRegisterNames()}}function removeTabThis(){removeTab(currentTab)}function uploadBin(e){var files=$("#fileInputElement")[0].files;if(files.length){var file=files[0],blob=file.slice(0,file.size),fr=new FileReader;fr.addEventListener("load",function(){for(var bytes=new Uint8Array(this.result),hexer="",i=0;i<bytes.length;i++)hexer+=bytes[i]<16?"0"+bytes[i].toString(16).toUpperCase()+" ":bytes[i].toString(16).toUpperCase()+" ";addTab(file.name,"",hexer)}),fr.readAsArrayBuffer(blob),$("#fileInputElement").val("")}}function uploadAsm(e){var files=$("#asmInputElement")[0].files;if(files.length){var file=files[0],blob=file.slice(0,file.size),fr=new FileReader;fr.addEventListener("load",function(){addTab(file.name,this.result,"")}),fr.readAsText(blob),$("#asmInputElement").val("")}}var defaultTab="<div class='selected'><span></span><div></div></div>";$(document).ready(function(){$("select").val(0);for(var i=1;i<3;i++)$("#theme"+i).prop("disabled",!0);editor=ace.edit("editor"),editor.setOption("firstLineNumber",0),editor.setTheme("ace/theme/oak"),editor.getSession().setMode("ace/mode/riscv"),editor.getSession().setUseWrapMode(!0),editor.$blockScrolling=1/0,mcEditor=$("#machineCode"),addTab("Untitled","add $0, $0, $0",""),$(".addTab").on("click",function(){addTab("Untitled","add $0, $0, $0","")}),$(".removeTab").on("click",function(){removeTabThis()}),$("#convertBtn").on("click",function(){converter()}),$("#consoleSel").on("change",function(){setConsoleMode($(this).val())}),$("#fileInputElement").on("change",function(e){uploadBin(e)}),$("#asmInputElement").on("change",function(e){uploadAsm(e)}),$(".loadAsm").on("click",function(){$("#asmInputElement").click()}),$(".loadBin").on("click",function(){$("#fileInputElement").click()}),$("#applyBtn").on("click",function(){var name=$("#filename").val();$("nav .selected span").html(name),tabs[currentTab].name=name;var memsize=$("#memsize").val();updateMemorySize(memsize);var isa=parseInt($("#isa").val());tabs[currentTab].instructionSet!=isa&&(tabs[currentTab].instructionSet=isa,delete tabs[currentTab].core,tabs[currentTab].core=createCore(isa,memsize,invokeEnvironmentCall,decodeCallback),switchModes(isa),setRegisterNames(),updateRegAndMemory())}),$("#sideGrabber").on("mousedown",function(e){var $element=$(this).parent(),$element2=$(this).parent().parent().find("section"),$element3=$(this).parent().parent().find("footer"),width=$(this).parent().parent().width();$(document).on("mouseup",function(e){$(document).off("mouseup").off("mousemove"),e.preventDefault()}),$(document).on("mousemove",function(me){var mx=100*me.pageX/width;mx=Math.min(90,Math.max(20,mx)),$element.css({width:100-mx+"%"}),$element2.css({width:mx+"%"}),$element3.css({width:mx+"%"}),me.preventDefault()}),e.preventDefault()}),$("#editorGrabber").on("mousedown",function(e){var $element=$(this).parent(),$element2=$(this).parent().parent().find("#editor"),width=$(this).parent().parent().width();$(document).on("mouseup",function(e){$(document).off("mouseup").off("mousemove"),e.preventDefault()}),$(document).on("mousemove",function(me){var mx=100*me.pageX/width;mx=Math.min(90,Math.max(20,mx)),$element.css({width:100-mx+"%"}),$element2.css({width:mx+"%"}),me.preventDefault()}),e.preventDefault()}),$("#yGrabber").on("mousedown",function(e){var $element=$(this).parent(),$element2=$(this).parent().parent().find("footer"),height=$(this).parent().parent().height(),pY=e.pageY-$(this).position().top+$element.position().top;$(document).on("mouseup",function(e){$(document).off("mouseup").off("mousemove"),e.preventDefault()}),$(document).on("mousemove",function(me){var my=100*(me.pageY-pY)/height;my=Math.min(90,Math.max(15,my)),$element.css({height:my+"%"}),$element2.css({height:100-my+"%"}),me.preventDefault()}),e.preventDefault()})}),$("#themes").change(function(){for(var themeID=$(this).val(),i=0;i<3;i++)$("#theme"+i).prop("disabled",i!=themeID)}),$("#editorSel").change(function(){1==$(this).val()?($("section > #editor").css({width:"50%"}),$("section > aside").css({width:"50%"})):($("section > #editor").css({width:"100%"}),$("section > aside").css({width:"0%"}))})}();
